<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š HistÃ³rico - CHEGA!</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <nav class="top-nav">
        <button class="back-btn" onclick="location.href='index.html'">â† Voltar</button>
        <h1>ğŸ“Š HistÃ³rico</h1>
        <button class="icon-btn" onclick="clearHistory()">ğŸ—‘ï¸</button>
    </nav>

    <main class="container">
        <!-- EstatÃ­sticas Gerais -->
        <section class="stats-summary">
            <h2>ğŸ“ˆ EstatÃ­sticas Gerais</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalEmergencies">0</div>
                    <div class="stat-label">EmergÃªncias</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-value" id="totalTrips">0</div>
                    <div class="stat-label">Trajetos</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-value" id="totalAlerts">0</div>
                    <div class="stat-label">Alertas Enviados</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-value" id="safeCancellations">0</div>
                    <div class="stat-label">Cancelamentos Seguros</div>
                </div>
            </div>
            
            <div class="time-range">
                <h3>ğŸ“… PerÃ­odo:</h3>
                <select id="timeRange" onchange="loadHistory()">
                    <option value="7">Ãšltimos 7 dias</option>
                    <option value="30" selected>Ãšltimos 30 dias</option>
                    <option value="90">Ãšltimos 3 meses</option>
                    <option value="365">Ãšltimo ano</option>
                    <option value="all">Todo histÃ³rico</option>
                </select>
            </div>
        </section>

        <!-- HistÃ³rico de EmergÃªncias -->
        <section class="emergency-history">
            <h2>ğŸš¨ HistÃ³rico de EmergÃªncias</h2>
            
            <div class="history-list" id="emergencyList">
                <!-- Itens serÃ£o inseridos por JavaScript -->
                <div class="empty-history">
                    <p>ğŸ“­ Nenhuma emergÃªncia registrada ainda.</p>
                    <p>Seu histÃ³rico aparecerÃ¡ aqui quando vocÃª usar o botÃ£o de emergÃªncia.</p>
                </div>
            </div>
        </section>

        <!-- HistÃ³rico de Trajetos -->
        <section class="trip-history">
            <h2>ğŸ“ HistÃ³rico de Trajetos</h2>
            
            <div class="history-list" id="tripList">
                <div class="empty-history">
                    <p>ğŸš¶â€â™€ï¸ Nenhum trajeto registrado ainda.</p>
                    <p>Use a funÃ§Ã£o "Acompanhamento" para registrar seus trajetos.</p>
                </div>
            </div>
        </section>

        <!-- HistÃ³rico de Alertas -->
        <section class="alert-history">
            <h2>ğŸ“± Alertas Enviados</h2>
            
            <div class="history-list" id="alertList">
                <div class="empty-history">
                    <p>ğŸ“¨ Nenhum alerta enviado ainda.</p>
                    <p>Os alertas enviados para seus contatos aparecerÃ£o aqui.</p>
                </div>
            </div>
        </section>

        <!-- GrÃ¡ficos (simplificado) -->
        <section class="charts-section">
            <h2>ğŸ“Š VisualizaÃ§Ã£o</h2>
            
            <div class="chart-container">
                <h3>EmergÃªncias por Hora do Dia</h3>
                <div class="chart-bar">
                    <div class="bar-label">ManhÃ£ (6h-12h)</div>
                    <div class="bar">
                        <div class="bar-fill" style="width: 25%"></div>
                    </div>
                    <div class="bar-value">25%</div>
                </div>
                
                <div class="chart-bar">
                    <div class="bar-label">Tarde (12h-18h)</div>
                    <div class="bar">
                        <div class="bar-fill" style="width: 40%"></div>
                    </div>
                    <div class="bar-value">40%</div>
                </div>
                
                <div class="chart-bar">
                    <div class="bar-label">Noite (18h-24h)</div>
                    <div class="bar">
                        <div class="bar-fill" style="width: 30%"></div>
                    </div>
                    <div class="bar-value">30%</div>
                </div>
                
                <div class="chart-bar">
                    <div class="bar-label">Madrugada (0h-6h)</div>
                    <div class="bar">
                        <div class="bar-fill" style="width: 5%"></div>
                    </div>
                    <div class="bar-value">5%</div>
                </div>
            </div>
        </section>

        <!-- ExportaÃ§Ã£o de Dados -->
        <section class="export-section">
            <h2>ğŸ’¾ Exportar Dados</h2>
            <p>Exporte seu histÃ³rico para anÃ¡lise pessoal ou backup.</p>
            
            <div class="export-options">
                <button onclick="exportJSON()" class="export-btn">
                    ğŸ“„ JSON (completo)
                </button>
                
                <button onclick="exportCSV()" class="export-btn">
                    ğŸ“Š CSV (planilha)
                </button>
                
                <button onclick="exportPDF()" class="export-btn">
                    ğŸ“‹ PDF (relatÃ³rio)
                </button>
                
                <button onclick="printHistory()" class="export-btn">
                    ğŸ–¨ï¸ Imprimir
                </button>
            </div>
            
            <div class="privacy-note">
                <p>ğŸ”’ Seus dados sÃ£o mantidos apenas no seu dispositivo.</p>
                <p>Nenhuma informaÃ§Ã£o Ã© enviada para servidores externos.</p>
            </div>
        </section>
    </main>

    <script>
        // Dados de exemplo
        const sampleData = {
            emergencies: [
                {
                    id: 1,
                    date: '2024-01-15',
                    time: '18:30',
                    duration: '2:15',
                    location: 'Av. Paulista, 1000',
                    type: 'emergency',
                    cancelled: true,
                    alertsSent: 3
                },
                {
                    id: 2,
                    date: '2024-01-10',
                    time: '22:15',
                    duration: '0:45',
                    location: 'MetrÃ´ SÃ©',
                    type: 'test',
                    cancelled: true,
                    alertsSent: 0
                }
            ],
            trips: [
                {
                    id: 1,
                    date: '2024-01-14',
                    start: '19:00',
                    end: '19:45',
                    duration: '0:45',
                    distance: '3.2 km',
                    sharedWith: 2
                }
            ],
            alerts: [
                {
                    id: 1,
                    date: '2024-01-15',
                    time: '18:30',
                    type: 'emergency',
                    to: 'JoÃ£o Silva',
                    status: 'delivered'
                },
                {
                    id: 2,
                    date: '2024-01-15',
                    time: '18:30',
                    type: 'emergency',
                    to: 'Maria Santos',
                    status: 'delivered'
                }
            ]
        };
        
        function loadHistory() {
            // Carregar dados reais do localStorage
            const emergencies = JSON.parse(localStorage.getItem('chega_emergencies') || '[]');
            const trips = JSON.parse(localStorage.getItem('chega_trips') || '[]');
            const alerts = JSON.parse(localStorage.getItem('chega_alerts') || '[]');
            
            // Usar dados de exemplo se nÃ£o houver dados reais
            const data = emergencies.length > 0 ? 
                { emergencies, trips, alerts } : sampleData;
            
            // Atualizar estatÃ­sticas
            document.getElementById('totalEmergencies').textContent = data.emergencies.length;
            document.getElementById('totalTrips').textContent = data.trips.length;
            document.getElementById('totalAlerts').textContent = data.alerts.length;
            document.getElementById('safeCancellations').textContent = 
                data.emergencies.filter(e => e.cancelled).length;
            
            // Renderizar listas
            renderEmergencyList(data.emergencies);
            renderTripList(data.trips);
            renderAlertList(data.alerts);
        }
        
        function renderEmergencyList(emergencies) {
            const container = document.getElementById('emergencyList');
            
            if (emergencies.length === 0) {
                container.innerHTML = `
                    <div class="empty-history">
                        <p>ğŸ“­ Nenhuma emergÃªncia registrada ainda.</p>
                        <p>Seu histÃ³rico aparecerÃ¡ aqui quando vocÃª usar o botÃ£o de emergÃªncia.</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            emergencies.forEach(emergency => {
                html += `
                    <div class="history-item emergency">
                        <div class="item-header">
                            <span class="item-icon">ğŸš¨</span>
                            <span class="item-title">${emergency.type === 'test' ? 'TESTE' : 'EMERGÃŠNCIA'}</span>
                            <span class="item-date">${emergency.date} ${emergency.time}</span>
                        </div>
                        <div class="item-details">
                            <p>ğŸ“ ${emergency.location}</p>
                            <p>â±ï¸ DuraÃ§Ã£o: ${emergency.duration}</p>
                            <p>ğŸ“± Alertas: ${emergency.alertsSent} enviados</p>
                            <p>${emergency.cancelled ? 'âœ… Cancelada com seguranÃ§a' : 'âš ï¸ ResoluÃ§Ã£o desconhecida'}</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function renderTripList(trips) {
            const container = document.getElementById('tripList');
            
            if (trips.length === 0) {
                container.innerHTML = `
                    <div class="empty-history">
                        <p>ğŸš¶â€â™€ï¸ Nenhum trajeto registrado ainda.</p>
                        <p>Use a funÃ§Ã£o "Acompanhamento" para registrar seus trajetos.</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            trips.forEach(trip => {
                html += `
                    <div class="history-item trip">
                        <div class="item-header">
                            <span class="item-icon">ğŸ“</span>
                            <span class="item-title">TRAJETO</span>
                            <span class="item-date">${trip.date}</span>
                        </div>
                        <div class="item-details">
                            <p>ğŸ•’ ${trip.start} - ${trip.end} (${trip.duration})</p>
                            <p>ğŸ“ DistÃ¢ncia: ${trip.distance}</p>
                            <p>ğŸ‘¥ Compartilhado com: ${trip.sharedWith} contatos</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function renderAlertList(alerts) {
            const container = document.getElementById('alertList');
            
            if (alerts.length === 0) {
                container.innerHTML = `
                    <div class="empty-history">
                        <p>ğŸ“¨ Nenhum alerta enviado ainda.</p>
                        <p>Os alertas enviados para seus contatos aparecerÃ£o aqui.</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            alerts.forEach(alert => {
                html += `
                    <div class="history-item alert">
                        <div class="item-header">
                            <span class="item-icon">ğŸ“±</span>
                            <span class="item-title">${alert.type.toUpperCase()}</span>
                            <span class="item-date">${alert.date} ${alert.time}</span>
                        </div>
                        <div class="item-details">
                            <p>ğŸ“ Para: ${alert.to}</p>
                            <p>ğŸ“¶ Status: ${alert.status === 'delivered' ? 'âœ… Entregue' : 'â³ Pendente'}</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function clearHistory() {
            if (confirm('âš ï¸ Limpar todo o histÃ³rico? Esta aÃ§Ã£o nÃ£o pode ser desfeita.')) {
                localStorage.removeItem('chega_emergencies');
                localStorage.removeItem('chega_trips');
                localStorage.removeItem('chega_alerts');
                alert('ğŸ—‘ï¸ HistÃ³rico limpo!');
                loadHistory();
            }
        }
        
        function exportJSON() {
            const data = {
                emergencies: JSON.parse(localStorage.getItem('chega_emergencies') || '[]'),
                trips: JSON.parse(localStorage.getItem('chega_trips') || '[]'),
                alerts: JSON.parse(localStorage.getItem('chega_alerts') || '[]'),
                exportedAt: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `chega-history-${new Date().getTime()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            alert('ğŸ“„ HistÃ³rico exportado como JSON!');
        }
        
        function exportCSV() {
            alert('ğŸ“Š ExportaÃ§Ã£o para CSV serÃ¡ implementada em breve!');
            // Converter dados para CSV e baixar
        }
        
        function exportPDF() {
            alert('ğŸ“‹ ExportaÃ§Ã£o para PDF serÃ¡ implementada em breve!');
            // Usar biblioteca como jsPDF
        }
        
        function printHistory() {
            window.print();
        }
        
        // Carregar histÃ³rico quando a pÃ¡gina carrega
        document.addEventListener('DOMContentLoaded', loadHistory);
    </script>
</body>
</html>