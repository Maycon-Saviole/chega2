<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHEGA! - Seguran√ßa Pessoal</title>
    <style>
        /* ESTILOS QUE FUNCIONAM */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
        }
        
        .logo {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        .tagline {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 40px;
        }
        
        /* BOT√ÉO QUE REALMENTE FUNCIONA */
        .emergency-btn {
            background: linear-gradient(45deg, #ff0000, #ff4444);
            color: white;
            border: none;
            border-radius: 50%;
            width: 200px;
            height: 200px;
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            margin: 30px auto;
            box-shadow: 0 10px 30px rgba(255, 0, 0, 0.4);
            display: block;
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .emergency-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0.3) 0%,
                rgba(255, 255, 255, 0) 80%
            );
            transform: rotate(30deg);
        }
        
        .emergency-btn:active {
            transform: scale(0.95);
        }
        
        .btn-text {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .btn-subtext {
            font-size: 0.6em;
            opacity: 0.8;
        }
        
        /* Status */
        .status {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        
        /* Instala√ß√£o */
        .install-btn {
            background: #4cd964;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            display: inline-block;
        }
        
        footer {
            margin-top: 40px;
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        /* Para celular */
        @media (max-width: 600px) {
            .emergency-btn {
                width: 180px;
                height: 180px;
                font-size: 1.6em;
            }
        }
        
        /* Anima√ß√µes */
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 20px rgba(255,0,0,0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 40px rgba(255,0,0,0.6); }
            100% { transform: scale(1); box-shadow: 0 0 20px rgba(255,0,0,0.4); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="logo">üö® CHEGA!</h1>
        <p class="tagline">Seguran√ßa pessoal para mulheres</p>
        
        <!-- BOT√ÉO PRINCIPAL -->
        <button id="emergencyBtn" class="emergency-btn pulse">
            <div class="btn-text">CHEGA!</div>
            <div class="btn-subtext">Clique para emerg√™ncia</div>
        </button>
        
        <p style="margin: 20px; opacity: 0.8;">
            üí° Segure por 3 segundos para ativa√ß√£o r√°pida<br>
            üì± No celular: Toque no bot√£o de volume 3x r√°pido
        </p>
        
        <!-- Status do sistema -->
        <div class="status">
            <div class="status-item">
                <span>üìç GPS:</span>
                <span id="gpsStatus">‚úÖ Ativo</span>
            </div>
            <div class="status-item">
                <span>üîä Som:</span>
                <span id="soundStatus">‚úÖ Pronto</span>
            </div>
            <div class="status-item">
                <span>üí° Flash:</span>
                <span id="flashStatus">‚úÖ Dispon√≠vel</span>
            </div>
        </div>
        
        <!-- A√ß√µes -->
        <div style="margin: 30px 0;">
            <button class="install-btn" onclick="testEmergency()">
                üß™ Testar Emerg√™ncia
            </button>
            <button class="install-btn" onclick="openSettings()" style="background: #007aff;">
                ‚öôÔ∏è Configura√ß√µes
            </button>
        </div>
        
        <!-- Links r√°pidos -->
        <div style="margin-top: 30px;">
            <button onclick="window.location.href='trip.html'" style="background: transparent; border: 1px solid white; color: white; padding: 10px 20px; margin: 5px; border-radius: 10px;">
                üìç Acompanhamento
            </button>
            <button onclick="window.location.href='contacts.html'" style="background: transparent; border: 1px solid white; color: white; padding: 10px 20px; margin: 5px; border-radius: 10px;">
                üë• Contatos
            </button>
        </div>
    </div>
    
    <footer>
        <p>Desenvolvido com ‚ù§Ô∏è por um pai e professor</p>
        <p>Gratuito ‚Ä¢ Seguro ‚Ä¢ Para todas</p>
    </footer>

    <!-- AUDIO PARA SIRENE (oculto) -->
    <audio id="sirenAudio" loop preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-warning-alarm-1006.mp3" type="audio/mp3">
    </audio>

    <script>
        // =========== SISTEMA DE EMERG√äNCIA COMPLETO ===========
        
        // Elementos
        const emergencyBtn = document.getElementById('emergencyBtn');
        const sirenAudio = document.getElementById('sirenAudio');
        let emergencyActive = false;
        let pressTimer;
        
        // =========== 1. CLIQUE SIMPLES ===========
        emergencyBtn.addEventListener('click', function() {
            // Ativa emerg√™ncia imediatamente
            activateEmergency();
        });
        
        // =========== 2. TOQUE LONGO (3 SEGUNDOS) ===========
        emergencyBtn.addEventListener('touchstart', function() {
            pressTimer = setTimeout(() => {
                activateEmergency();
            }, 3000);
        });
        
        emergencyBtn.addEventListener('touchend', function() {
            clearTimeout(pressTimer);
        });
        
        // Para mouse no PC
        emergencyBtn.addEventListener('mousedown', function() {
            pressTimer = setTimeout(() => {
                activateEmergency();
            }, 3000);
        });
        
        emergencyBtn.addEventListener('mouseup', function() {
            clearTimeout(pressTimer);
        });
        
        emergencyBtn.addEventListener('mouseleave', function() {
            clearTimeout(pressTimer);
        });
        
        // =========== 3. BOT√ÉO DE VOLUME (SIMULA√á√ÉO) ===========
        document.addEventListener('keydown', function(e) {
            // Detecta tecla 'v' (volume) ou setas
            if (e.key === 'v' || e.key === 'ArrowUp' || e.key === 'ArrowDown' || e.key === ' ') {
                activateEmergency();
            }
        });
        
        // =========== FUN√á√ÉO PRINCIPAL DE EMERG√äNCIA ===========
        function activateEmergency() {
            if (emergencyActive) return;
            emergencyActive = true;
            
            console.log('üö® EMERG√äNCIA ATIVADA!');
            
            // 1. EFEITOS VISUAIS - FLASH DA TELA
            startVisualEffects();
            
            // 2. SIRENE - SOM DE EMERG√äNCIA
            playSiren();
            
            // 3. VIBRA√á√ÉO (se dispon√≠vel)
            startVibration();
            
            // 4. REDIRECIONAR PARA TELA DE EMERG√äNCIA
            setTimeout(() => {
                window.location.href = 'emergency.html?emergency=true&time=' + Date.now();
            }, 1000);
            
            // 5. NOTIFICA√á√ÉO
            alert('üö® EMERG√äNCIA ATIVADA!\n\nSua localiza√ß√£o est√° sendo enviada para seus contatos.');
        }
        
        // =========== EFEITOS VISUAIS (FLASH) ===========
        function startVisualEffects() {
            // Efeito de flash na tela inteira
            let flashCount = 0;
            const maxFlashes = 20;
            
            function flash() {
                if (flashCount >= maxFlashes * 2) return;
                
                if (flashCount % 2 === 0) {
                    // Tela branca
                    document.body.style.backgroundColor = '#ffffff';
                    document.body.style.color = '#ff0000';
                } else {
                    // Tela vermelha
                    document.body.style.backgroundColor = '#ff0000';
                    document.body.style.color = '#ffffff';
                }
                
                flashCount++;
                setTimeout(flash, 250); // Pisca a cada 250ms
            }
            
            flash();
            
            // Efeito de tremor
            document.body.style.animation = 'shake 0.5s infinite';
            
            // Adicionar estilo de tremor
            const style = document.createElement('style');
            style.textContent = `
                @keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
                    20%, 40%, 60%, 80% { transform: translateX(10px); }
                }
            `;
            document.head.appendChild(style);
        }
        
        // =========== SIRENE ===========
        function playSiren() {
            try {
                // Tenta usar o √°udio pr√©-carregado
                sirenAudio.volume = 0.7;
                sirenAudio.play().catch(e => {
                    console.log('√Åudio bloqueado pelo navegador, criando fallback...');
                    createFallbackSiren();
                });
            } catch (e) {
                createFallbackSiren();
            }
        }
        
        function createFallbackSiren() {
            // Fallback usando Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Sirene oscilante
                let time = audioContext.currentTime;
                
                // Primeira oscila√ß√£o
                oscillator.frequency.setValueAtTime(800, time);
                oscillator.frequency.exponentialRampToValueAtTime(1600, time + 0.5);
                oscillator.frequency.exponentialRampToValueAtTime(800, time + 1);
                
                // Segunda oscila√ß√£o
                oscillator.frequency.exponentialRampToValueAtTime(1600, time + 1.5);
                oscillator.frequency.exponentialRampToValueAtTime(800, time + 2);
                
                gainNode.gain.setValueAtTime(0.3, time);
                
                oscillator.start();
                oscillator.stop(time + 30); // Para ap√≥s 30 segundos
                
            } catch (error) {
                console.log('Web Audio API n√£o suportada:', error);
                alert('üîä Sirene: Permita √°udio no navegador para som completo');
            }
        }
        
        // =========== VIBRA√á√ÉO ===========
        function startVibration() {
            if (navigator.vibrate) {
                // Padr√£o de vibra√ß√£o: longa-curta-longa (SOS em Morse)
                navigator.vibrate([
                    300, 100, 300, 100, 300,  // S (...)
                    700, 100, 700, 100, 700,   // O (---)
                    300, 100, 300, 100, 300,   // S (...)
                    2000                       // Pausa
                ]);
            }
        }
        
        // =========== TESTE DE EMERG√äNCIA ===========
        function testEmergency() {
            if (confirm('üß™ Iniciar TESTE de emerg√™ncia?\n\nIsso ir√°:\n‚Ä¢ Piscar a tela\n‚Ä¢ Tocar sirene\n‚Ä¢ Vibrar (se suportado)\n\n√â apenas um teste.')) {
                activateEmergency();
            }
        }
        
        // =========== CONFIGURA√á√ïES ===========
        function openSettings() {
            alert('‚öôÔ∏è Configura√ß√µes ser√£o implementadas em breve!\n\nPor enquanto, o app funciona com:\n‚Ä¢ Som de sirene\n‚Ä¢ Efeitos visuais\n‚Ä¢ Detec√ß√£o de toque longo');
        }
        
        // =========== VERIFICAR RECURSOS ===========
        function checkCapabilities() {
            // GPS
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    () => document.getElementById('gpsStatus').textContent = '‚úÖ Ativo',
                    () => document.getElementById('gpsStatus').textContent = '‚ùå Negado'
                );
            } else {
                document.getElementById('gpsStatus').textContent = '‚ùå N√£o suportado';
            }
            
            // √Åudio
            if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
                document.getElementById('soundStatus').textContent = '‚úÖ Dispon√≠vel';
            } else {
                document.getElementById('soundStatus').textContent = '‚ö†Ô∏è Limitado';
            }
            
            // Vibra√ß√£o
            if (navigator.vibrate) {
                // Teste r√°pido de vibra√ß√£o
                navigator.vibrate(100);
            }
            
            // Flash (simulado com tela)
            document.getElementById('flashStatus').textContent = '‚úÖ Dispon√≠vel';
        }
        
        // =========== PEDIR PERMISS√ïES NA PRIMEIRA VEZ ===========
        function requestPermissions() {
            if (!localStorage.getItem('chega_perms_asked')) {
                setTimeout(() => {
                    if (confirm('Para o CHEGA! funcionar melhor, precisamos de:\n\nüìç Localiza√ß√£o (para enviar sua posi√ß√£o em emerg√™ncias)\nüîî Notifica√ß√µes (para alertas)\nüîä √Åudio (para sirene)\n\nPermitir agora?')) {
                        // Solicitar localiza√ß√£o
                        if (navigator.geolocation) {
                            navigator.geolocation.getCurrentPosition(
                                () => console.log('üìç Localiza√ß√£o permitida'),
                                () => console.log('üìç Localiza√ß√£o negada')
                            );
                        }
                        
                        // Solicitar notifica√ß√µes
                        if ('Notification' in window && Notification.permission === 'default') {
                            Notification.requestPermission();
                        }
                    }
                    localStorage.setItem('chega_perms_asked', 'true');
                }, 1000);
            }
        }
        
        // =========== INICIALIZAR ===========
        window.addEventListener('load', function() {
            console.log('üöÄ CHEGA! App inicializado');
            checkCapabilities();
            requestPermissions();
            
            // Adicionar instru√ß√£o de volume
            if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                console.log('üì± Dispositivo m√≥vel detectado');
                emergencyBtn.innerHTML = `
                    <div class="btn-text">CHEGA!</div>
                    <div class="btn-subtext">Toque ou segure</div>
                    <div style="font-size:0.5em;margin-top:5px;">Volume: 3 toques</div>
                `;
            }
        });
        
        // =========== SIMULAR BOT√ïES DE VOLUME NO CELULAR ===========
        // Nota: Em navegadores web n√£o temos acesso direto ao bot√£o de volume
        // Esta √© uma simula√ß√£o para teste
        let volumePressCount = 0;
        let lastVolumePress = 0;
        
        // Simular com teclas num√©ricas para teste
        document.addEventListener('keydown', function(e) {
            if (e.key >= '0' && e.key <= '9') {
                const now = Date.now();
                if (now - lastVolumePress < 2000) { // Dentro de 2 segundos
                    volumePressCount++;
                    if (volumePressCount >= 3) {
                        console.log('üì± Bot√£o de volume pressionado 3x - EMERG√äNCIA!');
                        activateEmergency();
                        volumePressCount = 0;
                    }
                } else {
                    volumePressCount = 1;
                }
                lastVolumePress = now;
            }
        });
        
        // Para celular: detectar clique triplo
        let tapCount = 0;
        let lastTap = 0;
        
        emergencyBtn.addEventListener('click', function() {
            const now = Date.now();
            if (now - lastTap < 500) { // Dentro de 500ms
                tapCount++;
                if (tapCount >= 3) {
                    console.log('üëÜ Toque triplo detectado - EMERG√äNCIA!');
                    activateEmergency();
                    tapCount = 0;
                }
            } else {
                tapCount = 1;
            }
            lastTap = now;
        });
    </script>
</body>
</html>
