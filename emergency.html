<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš¨ EMERGÃŠNCIA - CHEGA!</title>
    <link rel="stylesheet" href="css/emergency.css">
    <script src="js/emergency.js" defer></script>
</head>
<body>
    <!-- Overlay de SOS -->
    <div id="sosOverlay" class="sos-overlay">
        <div class="sos-text">S O S</div>
        <div class="sos-icon">ğŸš¨</div>
    </div>

    <!-- ConteÃºdo Principal -->
    <main class="emergency-container">
        <!-- CabeÃ§alho -->
        <header class="emergency-header">
            <h1>ğŸš¨ EMERGÃŠNCIA ATIVADA</h1>
            <p class="subtitle">Seus contatos foram alertados</p>
        </header>

        <!-- Painel de Status -->
        <div class="status-panel">
            <div class="status-item">
                <span class="status-icon">ğŸ“</span>
                <div class="status-details">
                    <h3>LocalizaÃ§Ã£o</h3>
                    <p id="locationText">Enviando localizaÃ§Ã£o precisa...</p>
                </div>
            </div>
            
            <div class="status-item">
                <span class="status-icon">ğŸ“±</span>
                <div class="status-details">
                    <h3>Alertas Enviados</h3>
                    <p id="alertsCount">3 contatos notificados</p>
                </div>
            </div>
            
            <div class="status-item">
                <span class="status-icon">â±ï¸</span>
                <div class="status-details">
                    <h3>Tempo de EmergÃªncia</h3>
                    <p id="emergencyTimer">00:00</p>
                </div>
            </div>
        </div>

        <!-- Mapa de LocalizaÃ§Ã£o -->
        <div class="map-container">
            <h3>Sua LocalizaÃ§Ã£o Atual</h3>
            <div id="mapDisplay" class="map-display">
                <!-- Mapa serÃ¡ gerado por JavaScript -->
                <div class="map-placeholder">
                    <p>ğŸŒ Carregando mapa...</p>
                    <p id="coordinates">Obtendo coordenadas...</p>
                </div>
            </div>
            <button onclick="updateLocation()" class="btn-secondary">
                ğŸ”„ Atualizar LocalizaÃ§Ã£o
            </button>
        </div>

        <!-- AÃ§Ãµes de EmergÃªncia -->
        <div class="emergency-actions">
            <h3>AÃ§Ãµes DisponÃ­veis</h3>
            
            <button onclick="sendAdditionalAlert()" class="btn-alert">
                ğŸ“¢ Enviar Alerta Extra
            </button>
            
            <button onclick="callEmergency()" class="btn-call">
                ğŸ“ Ligar para 190
            </button>
            
            <button onclick="shareLocation()" class="btn-share">
                ğŸ“ Compartilhar LocalizaÃ§Ã£o
            </button>
        </div>

        <!-- InstruÃ§Ãµes -->
        <div class="instructions">
            <h3>ğŸ“‹ O QUE FAZER AGORA:</h3>
            <ol>
                <li>ğŸ‘‰ <strong>VÃ¡ para um local pÃºblico</strong> se possÃ­vel</li>
                <li>ğŸ‘‰ <strong>Mantenha o celular com vocÃª</strong></li>
                <li>ğŸ‘‰ <strong>Seus contatos receberam</strong> sua localizaÃ§Ã£o</li>
                <li>ğŸ‘‰ <strong>Autoridades podem ser acionadas</strong></li>
                <li>ğŸ‘‰ <strong>Toque em "ESTOU SEGURA"</strong> quando for seguro</li>
            </ol>
        </div>

        <!-- BotÃ£o de Cancelamento -->
        <div class="cancel-section">
            <button onclick="confirmCancel()" class="btn-safe">
                âœ… ESTOU SEGURA - CANCELAR EMERGÃŠNCIA
            </button>
            <p class="cancel-warning">
                âš ï¸ Esta aÃ§Ã£o serÃ¡ registrada e seus contatos serÃ£o avisados
            </p>
        </div>

        <!-- Log de Atividades -->
        <div class="activity-log">
            <h3>ğŸ“ Atividades Recentes</h3>
            <ul id="activityList">
                <li>ğŸ•’ 00:00 - EmergÃªncia ativada</li>
                <li>ğŸ“ 00:00 - LocalizaÃ§Ã£o obtida</li>
                <li>ğŸ“± 00:00 - Alertas enviados</li>
            </ul>
        </div>
    </main>

    <!-- Modal de ConfirmaÃ§Ã£o -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2>Confirmar Cancelamento</h2>
            <p>Tem certeza que estÃ¡ segura? Esta aÃ§Ã£o:</p>
            <ul>
                <li>âœ… NotificarÃ¡ seus contatos</li>
                <li>ğŸ“ SerÃ¡ registrada no histÃ³rico</li>
                <li>ğŸš¨ EncerrarÃ¡ todos os alertas</li>
            </ul>
            <div class="modal-actions">
                <button onclick="cancelEmergency()" class="btn-confirm">
                    SIM, ESTOU SEGURA
                </button>
                <button onclick="closeModal()" class="btn-cancel">
                    NÃƒO, CONTINUAR EMERGÃŠNCIA
                </button>
            </div>
        </div>
    </div>

    <script>
        // Script especÃ­fico da pÃ¡gina de emergÃªncia
        let emergencySeconds = 0;
        let timerInterval;
        
        function startTimer() {
            timerInterval = setInterval(() => {
                emergencySeconds++;
                const minutes = Math.floor(emergencySeconds / 60);
                const seconds = emergencySeconds % 60;
                document.getElementById('emergencyTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }
        
        function updateLocation() {
            // SimulaÃ§Ã£o - na prÃ¡tica usa Geolocation API
            document.getElementById('coordinates').textContent = 
                `ğŸ“ -23.5505Â°, -46.6333Â° (SÃ£o Paulo)`;
        }
        
        function sendAdditionalAlert() {
            alert('ğŸ“¢ Alerta extra enviado para seus contatos!');
            // Adiciona ao log
            const list = document.getElementById('activityList');
            const time = new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
            list.innerHTML = `<li>ğŸ“¢ ${time} - Alerta extra enviado</li>` + list.innerHTML;
        }
        
        function callEmergency() {
            window.open('tel:190', '_blank');
        }
        
        function shareLocation() {
            const coords = "-23.5505,-46.6333";
            const mapUrl = `https://maps.google.com/?q=${coords}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Minha LocalizaÃ§Ã£o - EMERGÃŠNCIA',
                    text: `Estou aqui: ${mapUrl}`,
                    url: mapUrl
                });
            } else {
                // Fallback
                navigator.clipboard.writeText(mapUrl);
                alert('ğŸ“ Link da localizaÃ§Ã£o copiado! Cole em qualquer app.');
            }
        }
        
        function confirmCancel() {
            document.getElementById('confirmModal').style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }
        
        function cancelEmergency() {
            // Para timer
            clearInterval(timerInterval);
            
            // Redireciona para dashboard
            window.location.href = 'index.html?emergency_cancelled=true';
        }
        
        // Iniciar quando carregar
        document.addEventListener('DOMContentLoaded', () => {
            startTimer();
            updateLocation();
            
            // Tentar tela cheia
            document.documentElement.requestFullscreen?.catch(() => {});
            
            // Vibrar (se permitido)
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
        });
        
        // Bloquear saÃ­da acidental
        window.onbeforeunload = function(e) {
            e.preventDefault();
            e.returnValue = 'A emergÃªncia ainda estÃ¡ ativa! Tem certeza que deseja sair?';
            return e.returnValue;
        };
    </script>
</body>
</html>